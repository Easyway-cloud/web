<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON/CSV Converter and Hash Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; background-color: #f4f4f4; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background-color: #45a049; }
        #result { margin-top: 20px; padding: 10px; background-color: #e7e7e7; border-radius: 4px; white-space: pre-wrap; /* Preserve formatting for JSON/CSV */ }
    </style>
</head>
<body>
    <div class="container">
        <h1>JSON/CSV Converter and Hash Generator</h1>

        <h2>a) Convert JSON to JavaScript Object</h2>
        <textarea id="jsonInput" placeholder='Enter JSON here (e.g., {"name": "Alice"})'></textarea>
        <button onclick="convertJsonToObject()">Convert to Object</button>

        <h2>b) Convert JSON to Date</h2>
        <textarea id="jsonDateInput" placeholder='Enter JSON date string (e.g., {"date": "2023-05-15T12:00:00Z"})'></textarea>
        <button onclick="convertJsonToDate()">Convert to Date</button>

        <h2>c) Convert JSON to CSV and CSV to JSON</h2>
        <textarea id="dataInput" placeholder="Enter JSON Array (for JSON to CSV) or CSV (for CSV to JSON)"></textarea>
        <button onclick="convertJsonToCsv()">JSON to CSV</button>
        <button onclick="convertCsvToJson()">CSV to JSON</button>

        <h2>d) Create Hash from String (SHA-256)</h2>
        <textarea id="hashInput" placeholder="Enter string to hash"></textarea>
        <button onclick="createHash()">Generate Hash</button>

        <div id="result"></div>
    </div>

    <script>
        const resultDiv = document.getElementById('result');
        const showResult = (message, isError = false) => {
            resultDiv.innerText = isError ? 'Error: ' + message : message;
        };

        // a) Convert JSON to Object
        const convertJsonToObject = () => {
            try {
                const jsObject = JSON.parse(document.getElementById('jsonInput').value);
                showResult('Converted Object: ' + JSON.stringify(jsObject, null, 2));
            } catch (e) {
                showResult(e.message, true);
            }
        };

        // b) Convert JSON to Date
        const convertJsonToDate = () => {
            try {
                const jsObject = JSON.parse(document.getElementById('jsonDateInput').value);
                const date = new Date(jsObject.date);
                showResult('Converted Date: ' + (isNaN(date) ? 'Invalid Date' : date.toString()));
            } catch (e) {
                showResult(e.message, true);
            }
        };

        // c.1) Convert JSON Array to CSV
        const convertJsonToCsv = () => {
            try {
                const jsArray = JSON.parse(document.getElementById('dataInput').value);
                if (!Array.isArray(jsArray) || jsArray.length === 0) throw new Error('Input must be a non-empty JSON array.');
                
                // Use Set to get unique keys from all objects to handle heterogeneous data
                const headers = Array.from(new Set(jsArray.flatMap(Object.keys)));
                
                const csvRows = [
                    headers.join(','),
                    ...jsArray.map(row => 
                        headers.map(h => JSON.stringify(row[h] || '')).join(',')
                    )
                ];
                showResult('Converted CSV:\n' + csvRows.join('\n'));
            } catch (e) {
                showResult(e.message, true);
            }
        };

        // c.2) Convert CSV to JSON
        const convertCsvToJson = () => {
            try {
                const csvInput = document.getElementById('dataInput').value.trim();
                const [headerLine, ...dataLines] = csvInput.split('\n');
                if (!headerLine) throw new Error('CSV input is empty.');
                
                const headers = headerLine.split(',').map(h => h.trim());
                
                const jsonArray = dataLines.map(line => {
                    const values = line.split(',');
                    return headers.reduce((obj, header, index) => ({
                        ...obj,
                        [header]: values[index] ? values[index].trim().replace(/^"(.*)"$/, '$1') : ''
                    }), {});
                }).filter(obj => Object.keys(obj).length > 0 && Object.values(obj).some(v => v !== '')); // Filter out empty lines
                
                showResult('Converted JSON:\n' + JSON.stringify(jsonArray, null, 2));
            } catch (e) {
                showResult(e.message, true);
            }
        };

        // d) Create Hash from String (Using CryptoJS.SHA256)
        const createHash = () => {
            try {
                const input = document.getElementById('hashInput').value;
                // Fix: convert the CryptoJS object output to a string
                const hash = CryptoJS.SHA256(input).toString(CryptoJS.enc.Hex);
                showResult('Generated Hash (SHA-256): ' + hash);
            } catch (e) {
                showResult(e.message, true);
            }
        };
    </script>
</body>
</html>
